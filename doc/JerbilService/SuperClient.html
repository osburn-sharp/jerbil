<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />

  <title>Class: JerbilService::SuperClient</title>

  <link rel="stylesheet" href="../rdoc.css" type="text/css" media="screen" />

  <script src="../js/jquery.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/thickbox-compressed.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/quicksearch.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/darkfish.js" type="text/javascript" charset="utf-8"></script>

</head>
<body id="top" class="class">

  <div id="metadata">
    <div id="home-metadata">
      <div id="home-section" class="section">
        <h3 class="section-header">
          <a href="../index.html">Home</a>
          <a href="../index.html#classes">Classes</a>
          <a href="../index.html#methods">Methods</a>
        </h3>
      </div>
    </div>

    <div id="file-metadata">
      <div id="file-list-section" class="section">
        <h3 class="section-header">In Files</h3>
        <div class="section-body">
          <ul>
          
            <li><a href="../lib/jerbil/jerbil_service/sclient_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="lib/jerbil/jerbil_service/sclient.rb">lib/jerbil/jerbil_service/sclient.rb</a></li>
          
          </ul>
        </div>
      </div>

      
    </div>

    <div id="class-metadata">
      
      <!-- Parent Class -->
      <div id="parent-class-section" class="section">
        <h3 class="section-header">Parent</h3>
        
        <p class="link">Object</p>
        
      </div>
      

      

      

      
      <!-- Method Quickref -->
      <div id="method-list-section" class="section">
        <h3 class="section-header">Methods</h3>
        <ul class="link-list">
          
          <li><a href="#method-c-new">::new</a></li>
          
          <li><a href="#method-c-stop">::stop</a></li>
          
          <li><a href="#method-i-config_file-3D">#config_file=</a></li>
          
          <li><a href="#method-i-no_daemon">#no_daemon</a></li>
          
          <li><a href="#method-i-no_syslog">#no_syslog</a></li>
          
          <li><a href="#method-i-output-3D">#output=</a></li>
          
          <li><a href="#method-i-quiet">#quiet</a></li>
          
          <li><a href="#method-i-start_service">#start_service</a></li>
          
          <li><a href="#method-i-stop_service">#stop_service</a></li>
          
          <li><a href="#method-i-verbose">#verbose</a></li>
          
        </ul>
      </div>
      

      
    </div>

    <div id="project-metadata">
      
      
      <div id="fileindex-section" class="section project-section">
        <h3 class="section-header">Files</h3>
        <ul>
        
          <li class="file"><a href="../Bugs_txt.html">Bugs.txt</a></li>
        
          <li class="file"><a href="../History_txt.html">History.txt</a></li>
        
          <li class="file"><a href="../README_rdoc.html">README.rdoc</a></li>
        
        </ul>
      </div>
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class/Module Index
          <span class="search-toggle"><img src="../images/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <ul class="link-list">
        
          <li><a href="../Jerbil.html">Jerbil</a></li>
        
          <li><a href="../Jerbil/Broker.html">Jerbil::Broker</a></li>
        
          <li><a href="../Jerbil/Config.html">Jerbil::Config</a></li>
        
          <li><a href="../Jerbil/InvalidPrivateKey.html">Jerbil::InvalidPrivateKey</a></li>
        
          <li><a href="../Jerbil/InvalidServerKey.html">Jerbil::InvalidServerKey</a></li>
        
          <li><a href="../Jerbil/InvalidService.html">Jerbil::InvalidService</a></li>
        
          <li><a href="../Jerbil/InvalidServiceKey.html">Jerbil::InvalidServiceKey</a></li>
        
          <li><a href="../Jerbil/JerbilConfigError.html">Jerbil::JerbilConfigError</a></li>
        
          <li><a href="../Jerbil/JerbilError.html">Jerbil::JerbilError</a></li>
        
          <li><a href="../Jerbil/JerbilServerError.html">Jerbil::JerbilServerError</a></li>
        
          <li><a href="../Jerbil/JerbilServiceError.html">Jerbil::JerbilServiceError</a></li>
        
          <li><a href="../Jerbil/MissingServer.html">Jerbil::MissingServer</a></li>
        
          <li><a href="../Jerbil/ServerConnectError.html">Jerbil::ServerConnectError</a></li>
        
          <li><a href="../Jerbil/ServerRecord.html">Jerbil::ServerRecord</a></li>
        
          <li><a href="../Jerbil/ServiceAlreadyRegistered.html">Jerbil::ServiceAlreadyRegistered</a></li>
        
          <li><a href="../Jerbil/ServiceCallbackMissing.html">Jerbil::ServiceCallbackMissing</a></li>
        
          <li><a href="../Jerbil/ServiceConfigError.html">Jerbil::ServiceConfigError</a></li>
        
          <li><a href="../Jerbil/ServiceConnectError.html">Jerbil::ServiceConnectError</a></li>
        
          <li><a href="../Jerbil/ServiceNotFound.html">Jerbil::ServiceNotFound</a></li>
        
          <li><a href="../Jerbil/ServiceNotLocal.html">Jerbil::ServiceNotLocal</a></li>
        
          <li><a href="../Jerbil/ServiceRecord.html">Jerbil::ServiceRecord</a></li>
        
          <li><a href="../Jerbil/Support.html">Jerbil::Support</a></li>
        
          <li><a href="../Jerbil/UnauthorizedMethod.html">Jerbil::UnauthorizedMethod</a></li>
        
          <li><a href="../JerbilService.html">JerbilService</a></li>
        
          <li><a href="../JerbilService/Base.html">JerbilService::Base</a></li>
        
          <li><a href="../JerbilService/Client.html">JerbilService::Client</a></li>
        
          <li><a href="../JerbilService/Config.html">JerbilService::Config</a></li>
        
          <li><a href="../JerbilService/SuperClient.html">JerbilService::SuperClient</a></li>
        
          <li><a href="../JerbilService/Support.html">JerbilService::Support</a></li>
        
          <li><a href="../Session.html">Session</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>

      
    </div>
  </div>

  <div id="documentation">
    <h1 class="class">JerbilService::SuperClient</h1>

    <div id="description" class="description">
      
<p>Super <a href="Client.html">Client</a> - a wrapper class for managing <a
href="../Jerbil.html">Jerbil</a> Services</p>

<p>Can be used to easily create a daemon script for a service. First gather
options from the command line using optparse and then call Sclient.new.
Within the block call the methods below in response to the options on the
command line. When the block closes the service will be started and will
wait for calls.</p>

    </div><!-- description -->

    
    <div id="5Buntitled-5D" class="documentation-section">
      

      

      

      

      <!-- Methods -->
      
      <div id="public-class-method-details" class="method-section section">
        <h3 class="section-header">Public Class Methods</h3>

      
        <div id="new-method" class="method-detail ">
          <a name="method-c-new"></a>

          
          <div class="method-heading">
            <span class="method-name">new</span><span
              class="method-args">(klass, &block)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="new-source">
<pre>
<span class="ruby-comment"># File lib/jerbil/jerbil_service/sclient.rb, line 33</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">klass</span>, &amp;<span class="ruby-identifier">block</span>)

  <span class="ruby-ivar">@daemonize</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-ivar">@config_file</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@verbose</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-ivar">@quiet</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-ivar">@no_syslog</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-ivar">@output</span> = <span class="ruby-identifier">$stderr</span>
  <span class="ruby-ivar">@klass</span> = <span class="ruby-identifier">klass</span>
  <span class="ruby-ivar">@name</span> = <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">downcase</span>
  <span class="ruby-ivar">@name_symbol</span> = <span class="ruby-ivar">@name</span>.<span class="ruby-identifier">to_sym</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">block</span>.<span class="ruby-identifier">call</span>(<span class="ruby-keyword">self</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">start_service</span>

<span class="ruby-keyword">end</span></pre>
            </div><!-- new-source -->
            
          </div>

          

          
        </div><!-- new-method -->

      
        <div id="stop-method" class="method-detail ">
          <a name="method-c-stop"></a>

          
          <div class="method-heading">
            <span class="method-name">stop</span><span
              class="method-args">(klass, &block)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="stop-source">
<pre>
<span class="ruby-comment"># File lib/jerbil/jerbil_service/sclient.rb, line 85</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">stop</span>(<span class="ruby-identifier">klass</span>, &amp;<span class="ruby-identifier">block</span>)

  <span class="ruby-identifier">sclient</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">klass</span>)

  <span class="ruby-identifier">block</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">sclient</span>)

  <span class="ruby-identifier">sclient</span>.<span class="ruby-identifier">stop_service</span>

<span class="ruby-keyword">end</span></pre>
            </div><!-- stop-source -->
            
          </div>

          

          
        </div><!-- stop-method -->

      
      </div><!-- public-class-method-details -->
    
      <div id="public-instance-method-details" class="method-section section">
        <h3 class="section-header">Public Instance Methods</h3>

      
        <div id="config_file-3D-method" class="method-detail ">
          <a name="method-i-config_file-3D"></a>

          
          <div class="method-heading">
            <span class="method-name">config_file=</span><span
              class="method-args">(cfile)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="config_file-3D-source">
<pre>
<span class="ruby-comment"># File lib/jerbil/jerbil_service/sclient.rb, line 76</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">config_file=</span>(<span class="ruby-identifier">cfile</span>)
  <span class="ruby-ivar">@config_file</span> = <span class="ruby-identifier">cfile</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- config_file-3D-source -->
            
          </div>

          

          
        </div><!-- config_file-3D-method -->

      
        <div id="no_daemon-method" class="method-detail ">
          <a name="method-i-no_daemon"></a>

          
          <div class="method-heading">
            <span class="method-name">no_daemon</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>start the service without daemonising</p>
            

            
            <div class="method-source-code" id="no_daemon-source">
<pre>
<span class="ruby-comment"># File lib/jerbil/jerbil_service/sclient.rb, line 56</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">no_daemon</span>
  <span class="ruby-ivar">@daemonize</span> = <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- no_daemon-source -->
            
          </div>

          

          
        </div><!-- no_daemon-method -->

      
        <div id="no_syslog-method" class="method-detail ">
          <a name="method-i-no_syslog"></a>

          
          <div class="method-heading">
            <span class="method-name">no_syslog</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="no_syslog-source">
<pre>
<span class="ruby-comment"># File lib/jerbil/jerbil_service/sclient.rb, line 72</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">no_syslog</span>
  <span class="ruby-ivar">@no_syslog</span> = <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- no_syslog-source -->
            
          </div>

          

          
        </div><!-- no_syslog-method -->

      
        <div id="output-3D-method" class="method-detail ">
          <a name="method-i-output-3D"></a>

          
          <div class="method-heading">
            <span class="method-name">output=</span><span
              class="method-args">(ofile)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="output-3D-source">
<pre>
<span class="ruby-comment"># File lib/jerbil/jerbil_service/sclient.rb, line 80</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">output=</span>(<span class="ruby-identifier">ofile</span>)
  <span class="ruby-ivar">@output</span> = <span class="ruby-identifier">ofile</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@quiet</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- output-3D-source -->
            
          </div>

          

          
        </div><!-- output-3D-method -->

      
        <div id="quiet-method" class="method-detail ">
          <a name="method-i-quiet"></a>

          
          <div class="method-heading">
            <span class="method-name">quiet</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>output absolutely nothing</p>
            

            
            <div class="method-source-code" id="quiet-source">
<pre>
<span class="ruby-comment"># File lib/jerbil/jerbil_service/sclient.rb, line 66</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">quiet</span>
  <span class="ruby-ivar">@quiet</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-ivar">@verbose</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-ivar">@output</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-string">'/dev/null'</span>, <span class="ruby-string">'w'</span>)
<span class="ruby-keyword">end</span></pre>
            </div><!-- quiet-source -->
            
          </div>

          

          
        </div><!-- quiet-method -->

      
        <div id="start_service-method" class="method-detail ">
          <a name="method-i-start_service"></a>

          
          <div class="method-heading">
            <span class="method-name">start_service</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="start_service-source">
<pre>
<span class="ruby-comment"># File lib/jerbil/jerbil_service/sclient.rb, line 95</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">start_service</span>

  <span class="ruby-ivar">@output</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Welcome to #{@klass.to_s} (#{@klass.ident})&quot;</span>

  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span> <span class="ruby-keyword">then</span>
    <span class="ruby-ivar">@output</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Quiet is: #{@quiet ? 'on' : 'off'}&quot;</span>
    <span class="ruby-ivar">@output</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Verbose is: #{@verbose ? 'on' : 'off'}&quot;</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-identifier">config</span> = <span class="ruby-ivar">@klass</span>.<span class="ruby-identifier">get_config</span>(<span class="ruby-ivar">@config_file</span>)

  <span class="ruby-ivar">@output</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Obtained configuration options&quot;</span>

  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">config</span>.<span class="ruby-identifier">each_pair</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
      <span class="ruby-ivar">@output</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;  :#{key} =&gt; #{value}&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@output</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Running Service in environment: #{config[:environment]}&quot;</span>

  <span class="ruby-identifier">pkey</span> = <span class="ruby-constant">Jerbil</span><span class="ruby-operator">::</span><span class="ruby-constant">Support</span>.<span class="ruby-identifier">create_private_key</span>(<span class="ruby-ivar">@name_symbol</span>, <span class="ruby-identifier">config</span>[<span class="ruby-value">:environment</span>], <span class="ruby-identifier">config</span>[<span class="ruby-value">:key_dir</span>])

  <span class="ruby-ivar">@output</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Created a private key in: #{config[:key_dir]}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>

  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@daemonize</span> <span class="ruby-keyword">then</span>
    <span class="ruby-ivar">@output</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;About to demonize this service&quot;</span>
    <span class="ruby-constant">Daemons</span>.<span class="ruby-identifier">daemonize</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@output</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Service is running in the foreground&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@no_syslog</span> <span class="ruby-keyword">then</span>
    <span class="ruby-ivar">@output</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Disabling messages to syslog&quot;</span>
    <span class="ruby-constant">Jelly</span>.<span class="ruby-identifier">disable_syslog</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@output</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Sending messages to syslog&quot;</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-ivar">@service</span> = <span class="ruby-ivar">@klass</span><span class="ruby-operator">::</span><span class="ruby-constant">Service</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">pkey</span>, <span class="ruby-identifier">config</span>)

  <span class="ruby-ivar">@output</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Registered Service with Jerbil&quot;</span>

  <span class="ruby-comment"># now create the pid file</span>
  <span class="ruby-constant">Jerbil</span><span class="ruby-operator">::</span><span class="ruby-constant">Support</span>.<span class="ruby-identifier">write_pid_file</span>(<span class="ruby-ivar">@name_symbol</span>, <span class="ruby-identifier">config</span>[<span class="ruby-value">:environment</span>], <span class="ruby-identifier">config</span>[<span class="ruby-value">:pid_dir</span>])

  <span class="ruby-ivar">@output</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Created a pid file for process: #{Process.pid}&quot;</span>

  <span class="ruby-ivar">@service</span>.<span class="ruby-identifier">wait</span>(<span class="ruby-identifier">pkey</span>)

  <span class="ruby-ivar">@output</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Service has stopped&quot;</span>

<span class="ruby-keyword">end</span></pre>
            </div><!-- start_service-source -->
            
          </div>

          

          
        </div><!-- start_service-method -->

      
        <div id="stop_service-method" class="method-detail ">
          <a name="method-i-stop_service"></a>

          
          <div class="method-heading">
            <span class="method-name">stop_service</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="stop_service-source">
<pre>
<span class="ruby-comment"># File lib/jerbil/jerbil_service/sclient.rb, line 151</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">stop_service</span>

  <span class="ruby-identifier">config</span> = <span class="ruby-ivar">@klass</span>.<span class="ruby-identifier">get_config</span>(<span class="ruby-ivar">@config_file</span>)
  <span class="ruby-identifier">pid</span> = <span class="ruby-value">0</span>

  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span> <span class="ruby-keyword">then</span>
    <span class="ruby-ivar">@output</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Obtained configuration options&quot;</span>
    <span class="ruby-identifier">config</span>.<span class="ruby-identifier">each_pair</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
      <span class="ruby-ivar">@output</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;  :#{key} =&gt; #{value}&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@output</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Stopping Service #{@klass.to_s} in environment: #{config[:environment]}&quot;</span>
  <span class="ruby-identifier">pkey</span> = <span class="ruby-constant">Jerbil</span><span class="ruby-operator">::</span><span class="ruby-constant">Support</span>.<span class="ruby-identifier">get_key_and_delete_file</span>(<span class="ruby-ivar">@name_symbol</span>, <span class="ruby-identifier">config</span>[<span class="ruby-value">:environment</span>], <span class="ruby-identifier">config</span>[<span class="ruby-value">:key_dir</span>])
  <span class="ruby-identifier">pid</span> = <span class="ruby-constant">Jerbil</span><span class="ruby-operator">::</span><span class="ruby-constant">Support</span>.<span class="ruby-identifier">get_pid_and_delete_file</span>(<span class="ruby-ivar">@name_symbol</span>, <span class="ruby-identifier">config</span>[<span class="ruby-value">:environment</span>], <span class="ruby-identifier">config</span>[<span class="ruby-value">:pid_dir</span>])

  <span class="ruby-identifier">service_opts</span> = {<span class="ruby-value">:name=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@name_symbol</span>, <span class="ruby-value">:env=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">config</span>[<span class="ruby-value">:environment</span>]}
  <span class="ruby-identifier">service_opts</span>[<span class="ruby-value">:host</span>] = <span class="ruby-constant">Socket</span>.<span class="ruby-identifier">gethostname</span>

  <span class="ruby-keyword">begin</span>
    <span class="ruby-comment"># find jerbil</span>
    <span class="ruby-identifier">jerbil_server</span> = <span class="ruby-constant">Jerbil</span>.<span class="ruby-identifier">get_local_server</span>

    <span class="ruby-comment"># now connect to it</span>
    <span class="ruby-identifier">jerbil</span> = <span class="ruby-identifier">jerbil_server</span>.<span class="ruby-identifier">connect</span>

    <span class="ruby-comment"># and get service</span>
    <span class="ruby-identifier">my_service</span> = <span class="ruby-identifier">jerbil</span>.<span class="ruby-identifier">get</span>(<span class="ruby-identifier">service_opts</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">my_service</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">then</span>
      <span class="ruby-ivar">@output</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Cannot find service through Jerbil&quot;</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">session</span> = <span class="ruby-identifier">my_service</span>.<span class="ruby-identifier">connect</span>

  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Jerbil</span><span class="ruby-operator">::</span><span class="ruby-constant">MissingServer</span>
    <span class="ruby-ivar">@output</span>.<span class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;Cannot find a local Jerbil server&quot;</span>)
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Jerbil</span><span class="ruby-operator">::</span><span class="ruby-constant">JerbilConfigError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">err</span>
    <span class="ruby-ivar">@output</span>.<span class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;Error in Jerbil Config File: #{err.message}&quot;</span>)
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Jerbil</span><span class="ruby-operator">::</span><span class="ruby-constant">JerbilServiceError</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">jerr</span>
    <span class="ruby-ivar">@output</span>.<span class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;Error with Jerbil Service: #{jerr.message}&quot;</span>)
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Jerbil</span><span class="ruby-operator">::</span><span class="ruby-constant">ServerConnectError</span>
    <span class="ruby-ivar">@output</span>.<span class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;Error connecting to Jerbil Server&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># now to do the stopping</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">session</span>.<span class="ruby-identifier">stop_callback</span>(<span class="ruby-identifier">pkey</span>)
    <span class="ruby-ivar">@output</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Stopped service successfully&quot;</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">DRb</span><span class="ruby-operator">::</span><span class="ruby-constant">DRbConnError</span>
    <span class="ruby-ivar">@ouput</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Service stopped, but not gracefully&quot;</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>

<span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">err</span>
  <span class="ruby-ivar">@output</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Error: #{err.message}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
  <span class="ruby-comment"># it went wrong, so fall back on pid killing</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">pid</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-keyword">then</span>
    <span class="ruby-ivar">@output</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Killing the process: #{pid}&quot;</span>
    <span class="ruby-constant">Process</span>.<span class="ruby-identifier">kill</span>(<span class="ruby-string">&quot;SIGKILL&quot;</span>, <span class="ruby-identifier">pid</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@output</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;No pid available - nothing to kill&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- stop_service-source -->
            
          </div>

          

          
        </div><!-- stop_service-method -->

      
        <div id="verbose-method" class="method-detail ">
          <a name="method-i-verbose"></a>

          
          <div class="method-heading">
            <span class="method-name">verbose</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>output extra information, unless quiet has been set</p>
            

            
            <div class="method-source-code" id="verbose-source">
<pre>
<span class="ruby-comment"># File lib/jerbil/jerbil_service/sclient.rb, line 61</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">verbose</span>
  <span class="ruby-ivar">@verbose</span> = <span class="ruby-keyword">true</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@quiet</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- verbose-source -->
            
          </div>

          

          
        </div><!-- verbose-method -->

      
      </div><!-- public-instance-method-details -->
    
    </div><!-- 5Buntitled-5D -->
  

  </div><!-- documentation -->

  <div id="validator-badges">
    <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
    <p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
      Rdoc Generator</a> 2</small>.</p>
  </div>

</body>
</html>

